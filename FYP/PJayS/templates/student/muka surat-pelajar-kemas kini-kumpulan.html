{% extends "layout.html" %}

{% block title %}
  Padam Data Pelajar - PJays KoopSystem
{% endblock %}

{% block content %}

<div class="pagetitle">
  <h1>Kemas Kini Data Pelajar Kumpulan</h1>
  <nav>
    <ol class="breadcrumb">
      <li class="breadcrumb-item">Muka Surat</li>
      <li class="breadcrumb-item">Pelajar</li>
      <li class="breadcrumb-item">Kemas Kini</li>
      <li class="breadcrumb-item active">Kumpulan</li>
    </ol>
  </nav>
</div><!-- Penutup Page Title -->

<section class="section">
  <div class="row">
    <div class="col-lg-12">

      <!-- Button Group -->
      <div class="btn-nav" style="position: relative;">
        <a href="{% url 'update_student_page' %}"><button type="button" class="btn-Individu ms-2">Individu</button></a>
        <a href="{% url 'update_student_kumpulan_page' %}"><button type="button" class="btn-Kumpulan active ms-2">Kumpulan</button></a>

        <div class="card">
          <div class="card-body">
            <div class="card">
              <div class="card-body">
                
                <form method="POST" action="{% url 'update_student_kumpulan_page' %}">
                  {% csrf_token %}
                  
                  <fieldset>
                    <h5 class="card-title">Tapisan</h5>
                    <div class="row mb-3">
                      <label class="col-sm-2 col-form-label">Tingkatan</label>
                      <div class="col-sm-10">
                        <select class="form-select" id="filterTingkatan" aria-label="Default select example" name="tingkatan">
                          <option selected disabled>Pilih</option>
                          <option value="1">1</option>
                          <option value="2">2</option>
                          <option value="3">3</option>
                          <option value="4">4</option>
                          <option value="5">5</option>
                        </select>
                        {% comment %} {{ form.tingkatan }} {% endcomment %}
                      </div>
                    </div>

                    <div class="row mb-3">
                      <label class="col-sm-2 col-form-label">Kelas</label>
                      <div class="col-sm-10">
                        <select class="form-select" id="filterKelas" aria-label="Default select example" name="kelas">
                          <option selected disabled>Pilih</option>
                          <option value="ANGGERIK">ANGGERIK</option>
                          <option value="CEMPAKA">CEMPAKA</option>
                          <option value="DAHLIA">DAHLIA</option>
                          <option value="MAWAR">MAWAR</option>
                          <option value="SEROJA">SEROJA</option>
                          <option value="TERATAI">TERATAI</option>
                          <option value="UM">UM</option>
                          <option value="UKM">UKM</option>
                          <option value="USM">USM</option>
                          <option value="LILY">LILY</option>
                        </select>
                        {% comment %} {{ form.kelas }} {% endcomment %}
                      </div>
                    </div>
                  </fieldset>
                </div>
              </div>

              <div class="card">
                <div class="card-body">
                  <fieldset>
                    <h5 class="card-title">Kemaskini Kumpulan</h5>
                      <div class="row mb-3">
                        <label class="col-sm-2 col-form-label">Tingkatan Baru</label>
                        <div class="col-sm-10">
                          <select class="form-select" id="newTingkatan" name="new_tingkatan">
                            <option value="" selected disabled>Pilih</option>
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                          </select>
                        </div>
                      </div>
                    
                      <div class="row mb-3">
                        <label class="col-sm-2 col-form-label">Kelas Baru</label>
                        <div class="col-sm-10">
                          <select class="form-select" id="newKelas" name="new_kelas">
                            <option value="" selected disabled>Pilih</option>
                            <option value="ANGGERIK">ANGGERIK</option>
                            <option value="CEMPAKA">CEMPAKA</option>
                            <option value="DAHLIA">DAHLIA</option>
                            <option value="MAWAR">MAWAR</option>
                            <option value="SEROJA">SEROJA</option>
                            <option value="TERATAI">TERATAI</option>
                            <option value="UM">UM</option>
                            <option value="UKM">UKM</option>
                            <option value="USM">USM</option>
                            <option value="LILY">LILY</option>
                          </select>
                        </div>
                      </div>
                    </fieldset>
                  </div>
                </div>

                <div class="card">
                  <div class="card-body">
                    <fieldset>
                      <h5 class="card-title">Maklumat Data Pelajar</h5>

                      <table class="table datatable" id="tblTambah">
                        <thead>
                          <tr>
                            <th>Pilih</th>
                            <th>ID member</th>
                            <th>No. IC</th>
                            <th>Nama</th>
                            <th>Jantina</th>
                            <th>Kaum</th>
                            <th>Agama</th>
                            <th>Alamat Rumah</th>
                            <th>Tingkatan</th>
                            <th>Kelas</th>
                            <th>Ahli</th>
                            <th>Modal Syer(RM)</th>
                            <th data-type="date" data-format="MM/DD/YYYY">Tarikh Pendaftaran</th>
                          </tr>
                        </thead>
                        <tbody>
                          {% for i in member %}
                          <tr class="student-row" data-tingkatan="{{ i.tingkatan }}" data-kelas="{{ i.kelas }}">
                            <td>
                              <input type="checkbox" name="selected_students[]" value="{{ i.member_id }}">
                            </td>
                            <td>{{ i.member_id }}</td>
                            <td>{{ i.ic_pelajar }}</td>
                            <td>{{ i.nama }}</td>
                            <td>{{ i.jantina }}</td>
                            <td>{{ i.kaum }}</td>
                            <td>{{ i.agama }}</td>
                            <td>{{ i.alamat_rumah }}</td>
                            <td>{{ i.tingkatan }}</td>
                            <td>{{ i.kelas }}</td>
                            <td>{{ i.ahli }}</td>
                            <td>{{ i.modal_syer }}</td>
                            <td>{{ i.tarikh_daftar }}</td>
                          </tr>
                          {% endfor %}
                        </tbody>
                      </table>
                      <br>
                      <div class="form-check">
                        <input type="checkbox" id="select-all" class="form-check-input">
                        <label class="form-check-label" for="select-all">Pilih Semua</label>
                      </div>
                      <br>
                    </fieldset>
                  </div>
                </div>

                <!-- Delete Button below the table -->
                <div class="form-btn">
                  <button type="submit" class="btn btn-primary">Kemas Kini Pelajar Terpilih</button>
                </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<script>
  document.getElementById("filterTingkatan").addEventListener("change", filterTable);

  function filterTable() {
      let dropdown, table, rows, cells, tingkatan, filter;
      
      dropdown = document.getElementById("filterTingkatan");
      table = document.getElementById("tblTambah");
      rows = table.getElementsByTagName("tr");
      filter = dropdown.value;

      // Loop through rows and hide those that don't match the filter
      for (let i = 1; i < rows.length; i++) { // Skip the first row (header row)
          cells = rows[i].getElementsByTagName("td");
          tingkatan = cells[8]; // Get the 9th column (index 8)

          // Check if the current row matches the filter
          if (!tingkatan || filter === "Pilih" || filter === tingkatan.textContent.trim()) {
              rows[i].style.display = ""; // Show the row
          } else {
              rows[i].style.display = "none"; // Hide the row
          }
      }
  }

</script>

{% endblock %}